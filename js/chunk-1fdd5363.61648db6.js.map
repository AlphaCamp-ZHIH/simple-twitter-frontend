{"version":3,"sources":["webpack:///./src/views/PrivateMessage.vue?f861","webpack:///./src/components/UserRooms.vue?ded4","webpack:///./src/assets/img/icon_send.svg","webpack:///./src/components/PrivateChatroom.vue?0448","webpack:///./src/views/PrivateMessage.vue?fc42","webpack:///./src/components/UserRooms.vue?9c7e","webpack:///src/components/UserRooms.vue","webpack:///./src/components/UserRooms.vue?cf00","webpack:///./src/components/UserRooms.vue?dcd2","webpack:///./src/components/PrivateChatroom.vue?e898","webpack:///src/components/PrivateChatroom.vue","webpack:///./src/components/PrivateChatroom.vue?3648","webpack:///./src/components/PrivateChatroom.vue?eb6b","webpack:///src/views/PrivateMessage.vue","webpack:///./src/views/PrivateMessage.vue?9d1e","webpack:///./src/views/PrivateMessage.vue?4cbe","webpack:///./src/assets/img/icon_mail-add.svg"],"names":["module","exports","render","_vm","this","_h","$createElement","_c","_self","staticClass","ref","on","$event","userRoomsHandleScroll","_v","attrs","showModal","_e","_l","user","key","id","afterClickUserRoom","userRoomsLimit","directives","name","rawName","value","currentRoom","expression","_s","account","messages","messageLoadMore","afterPostMsg","afterScrollTop","afterShowUserListModal","cancelModal","msgUsersFollowing","length","joinUserRoomAwait","_f","avatar","refInFor","preventDefault","stopPropagation","joinUserRoomConfirm","msgUsersUnFollowing","staticRenderFns","roomMember","class","lastMsg","content","fromRoomMember","createdAt","unreadNum","linked","isLinked","handleCLickUserRoom","mixins","props","initialUser","type","Object","required","data","computed","watch","created","fetchUser","methods","$emit","component","showLoadMore","handleScroll","initialCurrentRoom","showUserListModal","loadMoreLimit","msg","domProps","indexOf","_k","keyCode","postPrivateMsg","apply","arguments","target","composing","text","initialMessages","Array","initialMessageLoadMore","Number","socket","privateRoom","memberNum","isSelf","isLoading","isPostMsg","setTimeout","updateScroll","$refs","scrollHeight","updated","sockets","get_private_msg","push","$socket","emit","SenderId","currentUser","ReceiverId","userId","RoomId","icon","title","scrollTop","heightPoint","e","srcElement","loadMore","components","Sidebar","UserRooms","PrivateChatroom","Spinner","userRooms","userRoomAwait","privateRoomAwait","getPrivateRoomId","msgUnseenNum","msgUnseenRooms","msgUnreadRooms","isShowModal","joinPrivateRoom","getPrivateHistory","localStorage","setItem","JSON","stringify","$router","userRoomId","checkPastMsg","handleUserRoomAwait","unshift","map","joinPrivatePage","catchUserRoomId","getItem","fetchMsgUsers","join_private_room","get_msg_notice_details","unseenRooms","unreadRooms","update_msg_notice_details","messageNotice","removeItem","getPrivateRooms","offset","limit","roomId","parse","Date","awaitMsg","offsetHeight","joinUserRoomAwaitToFalse","leavePrivatePage","beforeDestroy"],"mappings":"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","file":"js/chunk-1fdd5363.61648db6.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrivateMessage.vue?vue&type=style&index=0&id=291bcd40&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserRooms.vue?vue&type=style&index=0&id=094a6154&scoped=true&lang=css&\"","module.exports = __webpack_public_path__ + \"img/icon_send.2d406717.svg\";","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrivateChatroom.vue?vue&type=style&index=0&id=68e430c7&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container private-message\"},[_c('Sidebar'),_c('div',{staticClass:\"private-message-wrap\"},[_c('section',{staticClass:\"private-users\"},[_c('div',{ref:\"userRoomsList\",staticClass:\"private-users-wrap\",on:{\"scroll\":function($event){return _vm.userRoomsHandleScroll($event)}}},[_c('h2',{staticClass:\"headbar\"},[_c('div',{staticClass:\"title\"},[_c('div',{staticClass:\"main-title\"},[_vm._v(\"訊息\")]),_c('div',{staticClass:\"add-msg-user\",attrs:{\"data-toggle\":\"modal\",\"data-target\":\"#newMessageModal\"},on:{\"click\":_vm.showModal}},[_c('img',{attrs:{\"src\":require(\"@/assets/img/icon_mail-add.svg\"),\"width\":\"30px\",\"alt\":\"\"}})])])]),_c('ul',{staticClass:\"private-users-list\"},[(_vm.isLoading)?_c('Spinner'):_vm._e(),_vm._l((_vm.userRooms),function(user){return _c('UserRooms',{key:user.id,attrs:{\"initialUser\":user},on:{\"after-click-user-room\":_vm.afterClickUserRoom}})}),(_vm.userRoomsLimit === 'limited')?_c('li',{staticClass:\"limited\"},[_vm._v(\" 已載入所有聊天室！ \")]):_vm._e()],2)])]),_c('section',{staticClass:\"private-chatroom\"},[_c('div',{staticClass:\"private-chatroom-wrap\"},[_c('h2',{staticClass:\"headbar\"},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.currentRoom.name),expression:\"currentRoom.name\"}],staticClass:\"title\"},[_c('div',{staticClass:\"main-title\"},[_vm._v(_vm._s(_vm.currentRoom.name))]),_c('div',{staticClass:\"sub-title\"},[_vm._v(\"@\"+_vm._s(_vm.currentRoom.account))])])]),_c('div',{staticClass:\"private-chatroomCard\"},[_c('PrivateChatroom',{attrs:{\"initialCurrentRoom\":_vm.currentRoom,\"initialMessages\":_vm.messages,\"initialMessageLoadMore\":_vm.messageLoadMore},on:{\"after-post-msg\":_vm.afterPostMsg,\"after-scroll-top\":_vm.afterScrollTop,\"after-show-user-list-modal\":_vm.afterShowUserListModal}})],1)])])]),(_vm.isShowModal)?_c('div',{staticClass:\"modal fade\",attrs:{\"id\":\"newMessageModal\",\"data-backdrop\":\"static\",\"data-keyboard\":\"false\",\"tabindex\":\"-1\",\"aria-labelledby\":\"newMessageModalLabel\",\"aria-hidden\":\"true\"}},[_c('div',{staticClass:\"modal-dialog\"},[_c('div',{staticClass:\"modal-content\"},[_c('div',{staticClass:\"modal-header\"},[_c('button',{staticClass:\"close\",attrs:{\"type\":\"button\",\"data-dismiss\":\"modal\",\"aria-label\":\"Close\"},on:{\"click\":_vm.cancelModal}},[_c('img',{attrs:{\"src\":require(\"@/assets/img/icon_close-og.svg\"),\"alt\":\"\"}})]),_c('span',[_vm._v(\"新訊息\")])]),_c('div',{staticClass:\"modal-body\"},[_c('form',{staticClass:\"create-tweet\",attrs:{\"action\":\"\"}},[_c('ul',{staticClass:\"message-users\"},[(_vm.msgUsersFollowing.length > 0)?_c('li',{staticClass:\"following\"},[_vm._v(\"正在跟隨的使用者\")]):_vm._e(),_vm._l((_vm.msgUsersFollowing),function(user){return _c('li',{key:user.id,staticClass:\"message-user\",on:{\"click\":function($event){return _vm.joinUserRoomAwait(user)}}},[_c('div',{staticClass:\"avatar\"},[_c('img',{attrs:{\"src\":_vm._f(\"emptyImage\")(user.avatar),\"alt\":\"\"}})]),_c('div',{staticClass:\"user-info\"},[_c('span',{ref:\"\",refInFor:true,staticClass:\"name\"},[_vm._v(_vm._s(user.name))]),_c('span',{staticClass:\"account\"},[_vm._v(\"@\"+_vm._s(user.account))])]),(user.joinUserRoomAwait)?_c('button',{staticClass:\"btn\",on:{\"click\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.joinUserRoomConfirm(user)}}},[_vm._v(\"開始聊天\")]):_vm._e()])}),(_vm.msgUsersUnFollowing.length > 0)?_c('li',{staticClass:\"un-following\"},[_vm._v(\"其他未跟隨的使用者\")]):_vm._e(),_vm._l((_vm.msgUsersUnFollowing),function(user){return _c('li',{key:user.id,staticClass:\"message-user\",on:{\"click\":function($event){return _vm.joinUserRoomAwait(user)}}},[_c('div',{staticClass:\"avatar\"},[_c('img',{attrs:{\"src\":_vm._f(\"emptyImage\")(user.avatar),\"alt\":\"\"}})]),_c('div',{staticClass:\"user-info\"},[_c('span',{ref:\"\",refInFor:true,staticClass:\"name\"},[_vm._v(_vm._s(user.name))]),_c('span',{staticClass:\"account\"},[_vm._v(\"@\"+_vm._s(user.account))])]),(user.joinUserRoomAwait)?_c('button',{staticClass:\"btn\",on:{\"click\":function($event){$event.preventDefault();$event.stopPropagation();return _vm.joinUserRoomConfirm(user)}}},[_vm._v(\"開始聊天\")]):_vm._e()])})],2)])])])])]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('li',{staticClass:\"notice\"},[_c('router-link',{staticClass:\"avatar\",attrs:{\"to\":(\"/users/\" + (_vm.user.roomMember.id))}},[_c('img',{attrs:{\"src\":_vm._f(\"emptyImage\")(_vm.user.roomMember.avatar),\"alt\":\"\"}})]),_c('div',{staticClass:\"notice-info\"},[_c('div',{staticClass:\"user-info\"},[_c('router-link',{staticClass:\"name\",attrs:{\"to\":(\"/users/\" + (_vm.user.roomMember.id))}},[_vm._v(\" \"+_vm._s(_vm.user.roomMember.name)+\" \")]),_c('span',{staticClass:\"account\"},[_vm._v(\"@\"+_vm._s(_vm.user.roomMember.account))])],1),_c('div',{staticClass:\"user-msg\",class:{ 'await-msg': _vm.user.lastMsg.content === '立即開啟對話吧 ▸'}},[_c('span',{staticClass:\"last-msg\"},[(!_vm.user.lastMsg.fromRoomMember)?_c('small',[_vm._v(\"你：\")]):_vm._e(),_vm._v(_vm._s(_vm.user.lastMsg.content)+\" \")]),_c('span',{staticClass:\"last-time\"},[_vm._v(_vm._s(_vm._f(\"fromNow\")(_vm.user.lastMsg.createdAt)))]),(_vm.user.unreadNum > 0)?_c('span',{staticClass:\"unread-number\"},[_vm._v(\" \"+_vm._s(_vm.user.unreadNum)+\" \")]):_vm._e()])]),_c('div',{staticClass:\"full-link\",class:{ linked: _vm.user.isLinked },on:{\"click\":_vm.handleCLickUserRoom}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <li class=\"notice\">\r\n      <!-- :class=\"{ 'new-user-room': user.newUserRoom }\" -->\r\n      <router-link\r\n        class=\"avatar\"\r\n        :to=\"`/users/${user.roomMember.id}`\"\r\n      >\r\n        <img :src=\"user.roomMember.avatar | emptyImage\" alt=\"\">\r\n      </router-link>\r\n      <div class=\"notice-info\">\r\n        <div class=\"user-info\">\r\n          <router-link\r\n            class=\"name\"\r\n            :to=\"`/users/${user.roomMember.id}`\"\r\n          >\r\n            {{ user.roomMember.name }}\r\n          </router-link>\r\n          <span class=\"account\">@{{ user.roomMember.account }}</span>\r\n        </div>\r\n        <div class=\"user-msg\" :class=\"{ 'await-msg': user.lastMsg.content === '立即開啟對話吧 ▸'}\">\r\n          <span class=\"last-msg\">\r\n            <small v-if=\"!user.lastMsg.fromRoomMember\">你：</small>{{ user.lastMsg.content }}\r\n          </span>\r\n          <span class=\"last-time\">{{ user.lastMsg.createdAt | fromNow }}</span>\r\n          <span \r\n            v-if=\"user.unreadNum > 0\" \r\n            class=\"unread-number\">\r\n            {{ user.unreadNum }}\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <!-- :to=\"{ name: 'message-await', params: { id: user.id } }\" -->\r\n      <div \r\n        class=\"full-link\"\r\n        :class=\"{ linked: user.isLinked }\"\r\n        @click=\"handleCLickUserRoom\"\r\n      >\r\n      </div>\r\n    </li>\r\n</template>\r\n<script>\r\nimport { emptyImageFilter } from \"../utils/mixins\";\r\nimport { fromNowFilter } from '../utils/mixins'\r\nimport { mapState } from 'vuex'\r\n\r\nexport default {\r\n  name: 'UserRooms',\r\n  mixins: [fromNowFilter,emptyImageFilter],\r\n  props: {\r\n    initialUser: {\r\n      type: Object,\r\n      required: true\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      user: {}\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['currentUser'])\r\n  },\r\n  watch: {\r\n    initialUser () {\r\n      this.user = this.initialUser\r\n    },\r\n  },\r\n  created () {\r\n    this.fetchUser()\r\n  },\r\n  methods: {\r\n    handleCLickUserRoom() {\r\n      this.user.unreadNum = 0\r\n      this.$emit('after-click-user-room', this.user)\r\n    },\r\n    fetchUser() {\r\n      this.user = this.initialUser\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\n.notice {\r\n  position: relative;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 10px 15px;\r\n  width: 100%;\r\n  border-bottom: 1px solid #e6ecf0;\r\n}\r\n.avatar {\r\n  position: relative;\r\n  z-index: 1;\r\n}\r\n.notice-info {\r\n  position: relative;\r\n  z-index: 1;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n  width: calc( 100% - 50px);\r\n  text-align: left;\r\n  pointer-events: none;\r\n}\r\n.avatar:hover ~ .full-link,\r\n.notice-info:hover + .full-link {\r\n  background-color: #F5F8FA;\r\n}\r\n.name {\r\n  font-weight: bold;\r\n  pointer-events: visiblefill;\r\n}\r\n.notice-content {\r\n  margin: 10px 0;\r\n}\r\n.full-link {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  z-index: 0;\r\n}\r\n.full-link:hover {\r\n  background-color: #F5F8FA;\r\n  cursor: pointer;\r\n  transition: .2s ease-in-out;\r\n}\r\n.name:hover {\r\n  color: #FF6600;\r\n  text-decoration: none;\r\n}\r\n.account {\r\n  font-size: 14px;\r\n}\r\n.last-msg {\r\n  display: inline-block;\r\n  max-width: 250px;\r\n  text-overflow: ellipsis;\r\n  overflow: hidden;\r\n  white-space : nowrap;\r\n}\r\n.last-time {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  font-size: 14px;\r\n}\r\n.await-msg .last-msg {\r\n  color: #ff6600;\r\n}\r\n.await-msg .last-time {\r\n  display: none;\r\n}\r\n.unread-number {\r\n  position: absolute;\r\n  bottom: 0;\r\n  right: 0;\r\n  display: block;\r\n  min-width: 25px;\r\n  height: 25px;\r\n  line-height: 25px;\r\n  border-radius: 25px;\r\n  text-align: center;\r\n  background: #ff6600;\r\n  color: #fff;\r\n}\r\n.full-link {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  z-index: 0;\r\n  border-right: 2px solid #fff;\r\n}\r\n.full-link:hover,\r\n.full-link.linked {\r\n  background-color: #f5f8fa;\r\n  cursor: pointer;\r\n}\r\n.full-link:hover {\r\n  border-right: 2px solid #f5f8fa;\r\n  transition: .2s ease-in-out;\r\n}\r\n.full-link.linked {\r\n  border-right: 2px solid #ff6600;\r\n}\r\n@media (max-width: 768px) {\r\n  .PublicMessage .avatar {\r\n    width: 40px;\r\n    height: 40px;\r\n  }\r\n}\r\n@media (max-width: 576px) {\r\n  .PublicMessage .avatar {\r\n    width: 30px;\r\n    height: 30px;\r\n  }\r\n  .name,\r\n  .account {\r\n    font-size: 14px;\r\n  }\r\n  .notice-info .user-info {\r\n    margin-bottom: 0;\r\n  }\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserRooms.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserRooms.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UserRooms.vue?vue&type=template&id=094a6154&scoped=true&\"\nimport script from \"./UserRooms.vue?vue&type=script&lang=js&\"\nexport * from \"./UserRooms.vue?vue&type=script&lang=js&\"\nimport style0 from \"./UserRooms.vue?vue&type=style&index=0&id=094a6154&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"094a6154\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"messages\",staticClass:\"chat-wrap\",class:{ 'show-load-more': _vm.showLoadMore },on:{\"scroll\":function($event){return _vm.handleScroll($event)}}},[(!_vm.initialCurrentRoom.name)?_c('div',{staticClass:\"privateroom-await\"},[_c('p',[_vm._v(\"你未選取訊息\")]),_c('span',[_vm._v(\"從你現有的訊息中選擇一則，或開始一則新訊息。\")]),_c('button',{staticClass:\"btn\",attrs:{\"data-toggle\":\"modal\",\"data-target\":\"#newMessageModal\"},on:{\"click\":_vm.showUserListModal}},[_vm._v(\" 新訊息 \")])]):_vm._e(),(_vm.initialCurrentRoom.name)?_c('div',{staticClass:\"chat messages\",attrs:{\"id\":\"messages\"}},[(_vm.loadMoreLimit === 'limited')?_c('div',{staticClass:\"load-text load-limited\"},[_vm._v(\" 沒有更多訊息了！ \")]):_vm._e(),(_vm.showLoadMore)?_c('div',{staticClass:\"load-text load-more\"},[_c('span',{staticClass:\"loading\"}),_c('span',[_vm._v(\"正在載入訊息...\")])]):_vm._e(),_vm._l((_vm.messages),function(msg){return _c('div',{key:msg.id},[(msg.isSelf)?_c('div',{staticClass:\"self msg\"},[_c('p',[_vm._v(\" \"+_vm._s(msg.content)+\" \")]),_c('span',[_vm._v(_vm._s(_vm._f(\"fromNow\")(msg.createdAt)))])]):_c('div',{staticClass:\"other msg\"},[_c('router-link',{staticClass:\"avatar\",attrs:{\"to\":(\"/users/\" + (msg.UserId))}},[_c('img',{attrs:{\"src\":_vm._f(\"emptyImage\")(msg.avatar),\"alt\":\"\"}})]),_c('div',{},[_c('p',[_vm._v(\" \"+_vm._s(msg.content)+\" \")]),_c('span',[_vm._v(_vm._s(_vm._f(\"fromNow\")(msg.createdAt)))])])],1)])})],2):_vm._e(),_c('div',{staticClass:\"d-flex justify-content-center align-items-center send-wrap\"},[(_vm.initialCurrentRoom.name)?[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.text),expression:\"text\"}],attrs:{\"placeholder\":\"請輸入訊息 ...\",\"type\":\"text\",\"maxlength\":\"160\"},domProps:{\"value\":(_vm.text)},on:{\"keypress\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.postPrivateMsg.apply(null, arguments)},\"input\":function($event){if($event.target.composing){ return; }_vm.text=$event.target.value}}}),_c('button',{staticClass:\"send-btn\",attrs:{\"type\":\"button\"},on:{\"click\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.postPrivateMsg.apply(null, arguments)}}},[_c('img',{attrs:{\"src\":require(\"@/assets/img/icon_send.svg\"),\"alt\":\"\"}})])]:_vm._e()],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div \r\n    class=\"chat-wrap\" \r\n    :class=\"{ 'show-load-more': showLoadMore }\"\r\n    ref=\"messages\" \r\n    @scroll=\"handleScroll($event)\"\r\n    >\r\n    <div\r\n      v-if=\"!initialCurrentRoom.name\"\r\n      class=\"privateroom-await\">\r\n      <p>你未選取訊息</p>\r\n      <span>從你現有的訊息中選擇一則，或開始一則新訊息。</span>\r\n      <button \r\n        class=\"btn\" \r\n        @click=\"showUserListModal\" \r\n        data-toggle=\"modal\" \r\n        data-target=\"#newMessageModal\">\r\n        新訊息\r\n      </button>\r\n    </div>\r\n    <div \r\n      v-if=\"initialCurrentRoom.name\"\r\n      class=\"chat messages\" id=\"messages\">\r\n      <div v-if=\"loadMoreLimit === 'limited'\" class=\"load-text load-limited\">\r\n        沒有更多訊息了！\r\n      </div>\r\n      <div v-if=\"showLoadMore\" class=\"load-text load-more\">\r\n        <span class=\"loading\"></span><span>正在載入訊息...</span>\r\n      </div>\r\n      <div v-for=\"msg in messages\" :key=\"msg.id\" class=\"\" >\r\n        <div \r\n          v-if=\"msg.isSelf\"\r\n          class=\"self msg\" >\r\n          <p>\r\n            {{ msg.content }}\r\n          </p>\r\n          <span>{{ msg.createdAt | fromNow }}</span>\r\n        </div>\r\n        <div \r\n          v-else\r\n          class=\"other msg\">\r\n          <router-link :to=\"`/users/${msg.UserId}`\" class=\"avatar\">\r\n            <img :src=\"msg.avatar | emptyImage\" alt=\"\">\r\n          </router-link>\r\n          <div class=\"\">\r\n            <p>\r\n              {{ msg.content }}\r\n            </p>\r\n            <span>{{ msg.createdAt | fromNow }}</span>\r\n          </div>\r\n        </div> \r\n      </div>\r\n    </div>\r\n    <div class=\"d-flex justify-content-center align-items-center send-wrap\">\r\n      <template v-if=\"initialCurrentRoom.name\">\r\n        <input \r\n          v-model=\"text\"\r\n          placeholder=\"請輸入訊息 ...\"\r\n          type=\"text\"\r\n          maxlength=\"160\"\r\n          @keypress.enter=\"postPrivateMsg\"\r\n        >\r\n        <button \r\n          class=\"send-btn\"\r\n          type=\"button\"\r\n          @click.stop.prevent=\"postPrivateMsg\"\r\n        >\r\n          <img src=\"~@/assets/img/icon_send.svg\" alt=\"\">\r\n        </button>\r\n      </template>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { mapState } from 'vuex'\r\nimport { Toast } from './../utils/helpers'\r\nimport { emptyImageFilter } from \"../utils/mixins\"\r\nimport { fromNowFilter } from './../utils/mixins'\r\n\r\nexport default {\r\n  name: 'PrivateChatroom',\r\n  mixins: [fromNowFilter,emptyImageFilter],\r\n  props: {\r\n    initialCurrentRoom: {\r\n      type: Object,\r\n      required: true\r\n    },\r\n    initialMessages: {\r\n      type: Array,\r\n      required: true\r\n    },\r\n    initialMessageLoadMore: {\r\n      type: Number,\r\n      required: true\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      socket: null,\r\n      privateRoom: {},\r\n      text: '',\r\n      memberNum: 0, \r\n      messages: [],\r\n      loadMoreLimit: 20,\r\n      showLoadMore: false,\r\n      isSelf: false,\r\n      isLoading: true,\r\n      isPostMsg: false\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState(['currentUser'])\r\n  },\r\n  watch: {\r\n    initialCurrentRoom() {\r\n      this.privateRoom = this.initialCurrentRoom\r\n    },\r\n    initialMessages() {\r\n      this.messages = this.initialMessages\r\n    },\r\n    initialMessageLoadMore () {\r\n      this.loadMoreLimit = this.initialMessageLoadMore\r\n    },\r\n    isPostMsg(value) {\r\n      if (value) {\r\n        setTimeout(() => { \r\n          this.text = ''\r\n        }, 500)\r\n      }\r\n    },\r\n    text(value) {\r\n      if (value === '' && this.isPostMsg) {\r\n        this.updateScroll(this.$refs.messages.scrollHeight)\r\n        this.isPostMsg = false\r\n      }\r\n    },\r\n    loadMoreLimit (value) {\r\n      if (value === 'limited') {\r\n        setTimeout(() => { \r\n          this.loadMoreLimit = 'nomore'\r\n        }, 3000)\r\n      } \r\n    },\r\n    showLoadMore(value) {\r\n      if (value) {\r\n        setTimeout(() => { \r\n          this.showLoadMore = false\r\n        }, 2500)\r\n      }\r\n    }\r\n  },\r\n  updated () {\r\n    if (this.loadMoreLimit === 20) {\r\n      this.updateScroll(this.$refs.messages.scrollHeight)\r\n    }\r\n  },\r\n  sockets: {\r\n    get_private_msg(data) {\r\n      this.messages.push(data)\r\n    }\r\n  },\r\n  methods: {\r\n    postPrivateMsg() { \r\n      if (!this.text.length) {\r\n        Toast.fire({\r\n          icon: 'warning',\r\n          title: '你還沒有填寫訊息'\r\n        })\r\n        return\r\n      }\r\n      this.$socket.emit('post_private_msg', { \r\n        SenderId: this.currentUser.id,\r\n        ReceiverId: this.privateRoom.userId,\r\n        RoomId: this.privateRoom.id,\r\n        content: this.text,\r\n      })\r\n      \r\n      const avatar = this.currentUser.avatar\r\n      const content = this.text\r\n      const createdAt = new Date()\r\n      const data = {\r\n        avatar,\r\n        content,\r\n        createdAt,\r\n        isSelf: true\r\n      }\r\n      this.messages.push( data )\r\n      this.$emit('after-post-msg', this.text)\r\n      this.isPostMsg = true\r\n    },\r\n    updateScroll(heightPoint) {\r\n      this.$refs.messages.scrollTop = heightPoint\r\n    },\r\n    handleScroll(e) {\r\n      if (e.srcElement.scrollTop === 0 ) {\r\n        this.loadMore()\r\n      }\r\n      if (this.loadMoreLimit === 'nomore') {\r\n        this.loadMoreLimit = 'limited'\r\n      }\r\n    },\r\n    loadMore() {\r\n      if (this.messages.length >= this.loadMoreLimit) {\r\n        this.showLoadMore = true\r\n\r\n        const limit = this.messages.length + 5\r\n        setTimeout(() => { \r\n          this.$emit('after-scroll-top', limit)\r\n          this.loadMoreLimit = limit\r\n        }, 2000)\r\n        \r\n      } else if (this.loadMoreLimit - this.messages.length <= 5){\r\n        this.loadMoreLimit = 'limited'\r\n      }\r\n    },\r\n    showUserListModal() {\r\n      this.$emit('after-show-user-list-modal')\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\n.chat-wrap {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: calc( 100vh - 110px);\r\n  overflow-y: scroll;\r\n  overscroll-behavior-y: contain;\r\n  box-sizing: border-box;\r\n}\r\n.chat::-webkit-scrollbar {\r\n  display: none;\r\n}\r\n.messages {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n.chat > div{\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: flex-end;\r\n  align-items: center;\r\n  width: 100%;\r\n  /* height: 100%; */\r\n  margin: 0 auto;\r\n  padding: 15px;\r\n}\r\n.other {\r\n  align-self: flex-start;\r\n  display: flex;\r\n  align-items: flex-end;\r\n  margin-bottom: 10px;\r\n}\r\n.self {\r\n  text-align: right;\r\n  align-self: flex-end;\r\n  margin-bottom: 10px;\r\n}\r\n.other > div {\r\n  text-align: left;\r\n}\r\n.msg p {\r\n  width: auto;\r\n  max-width: 400px;\r\n  padding: 15px 20px;\r\n  margin-bottom: 0;\r\n  font-size: 20px;\r\n}\r\n.msg span {\r\n  font-size: 13px;\r\n  color: #6f767a;\r\n}\r\n.other a {\r\n  margin-bottom: 23px;\r\n}\r\n.other p {\r\n  background: #e6edf1;\r\n  border-radius: 20px 20px 20px 0;\r\n}\r\n.self p {\r\n  color: #fff;\r\n  background: #ff6600;\r\n  border-radius: 20px 20px 0 20px;\r\n}\r\n.user_join {\r\n  background: #ccc;\r\n  padding: 5px 15px;\r\n  margin: 0;\r\n  border-radius: 50px;\r\n}\r\n.send-wrap {\r\n  position: absolute;\r\n  bottom: 0;\r\n  align-items: center;\r\n  width: 100%;\r\n  height: 100%;\r\n  max-height: 60px;\r\n  padding: 10px;\r\n  box-sizing: border-box;\r\n  border-width: 1px 0;\r\n  border-style: solid;\r\n  border-color: #e6ecf0;\r\n  background: #fff;\r\n}\r\ninput {\r\n    width: 100%;\r\n    height: 35px;\r\n    padding-left: 20px;\r\n    border: 1px solid #dde3e6;\r\n    border-radius: 30px;\r\n    background: #d5dee3;\r\n    outline: none;\r\n}\r\n.send-btn {\r\n      width: auto;\r\n    margin: 0 20px;\r\n}\r\n.send-btn img {\r\n  width: 20px;\r\n  filter: invert(73%) sepia(100%) saturate(48) hue-rotate(364deg);\r\n  transition: .3s ease-in-out;\r\n}\r\n.send-btn:hover img {\r\n  transform: scale(1.2);\r\n  transition: .3s ease-in-out;\r\n}\r\n.privateroom-await p {\r\n  margin-bottom: 5px;\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n}\r\n.privateroom-await span {\r\n  display: block;\r\n  margin-bottom: 10px;\r\n}\r\n.privateroom-await .btn {\r\n  color: #fff;\r\n  background-color: #ff6600;\r\n}\r\n.chat > .load-more {\r\n  flex-direction: row;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: #fdaa72;\r\n}\r\n.loading {\r\n  height: 15px;\r\n  width: 15px;\r\n  border-radius: 100%;\r\n  margin: 6px;\r\n  border: 2px solid #fdaa72;\r\n  border-bottom-color: transparent;\r\n  vertical-align: middle;\r\n  -webkit-animation: rotate 0.75s linear infinite;\r\n  animation: rotate 0.75s linear infinite;\r\n}\r\n.load-more span:last-child {\r\n  padding-top: 5px;\r\n}\r\n.load-limited {\r\n  color: #ccc;\r\n}\r\n.show-load-more {\r\n  overflow-y: hidden;\r\n}\r\n@keyframes rotate {\r\n  0% {\r\n      -webkit-transform: rotate(0deg);\r\n  }\r\n  100% {\r\n      -webkit-transform: rotate(360deg);\r\n  }\r\n}\r\n@media (max-width: 576px) {\r\n  .chat {\r\n    margin-bottom: 10vh;\r\n  }\r\n  .msg p {\r\n    max-width: 180px;\r\n    font-size: 14px;\r\n  }\r\n  .privateroom-await span {\r\n    max-width: 250px;\r\n  }\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrivateChatroom.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrivateChatroom.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PrivateChatroom.vue?vue&type=template&id=68e430c7&scoped=true&\"\nimport script from \"./PrivateChatroom.vue?vue&type=script&lang=js&\"\nexport * from \"./PrivateChatroom.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PrivateChatroom.vue?vue&type=style&index=0&id=68e430c7&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"68e430c7\",\n  null\n  \n)\n\nexport default component.exports","<template>\r\n  <div class=\"container private-message\">\r\n    <Sidebar /> \r\n    <div class=\"private-message-wrap\">\r\n      <section class=\"private-users\">\r\n        <div class=\"private-users-wrap\" ref=\"userRoomsList\" @scroll=\"userRoomsHandleScroll($event)\">\r\n          <h2 class=\"headbar\">\r\n            <div class=\"title\">\r\n              <div class=\"main-title\">訊息</div>\r\n              <div \r\n                class=\"add-msg-user\"\r\n                data-toggle=\"modal\"\r\n                data-target=\"#newMessageModal\"\r\n                @click=\"showModal\">\r\n                <img src=\"~@/assets/img/icon_mail-add.svg\" width=\"30px\" alt=\"\" />\r\n              </div>\r\n            </div>\r\n          </h2>\r\n          <ul\r\n            class=\"private-users-list\">\r\n            <Spinner v-if=\"isLoading\"/>\r\n            <UserRooms\r\n              v-for=\"user in userRooms\"\r\n              :key=\"user.id\"\r\n              :initialUser=\"user\" \r\n              @after-click-user-room=\"afterClickUserRoom\"\r\n            />\r\n            <li v-if=\"userRoomsLimit === 'limited'\" class=\"limited\">\r\n              已載入所有聊天室！\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </section>\r\n      <section class=\"private-chatroom\">\r\n        <div class=\"private-chatroom-wrap\">\r\n          <h2 class=\"headbar\">\r\n            <div\r\n              v-show=\"currentRoom.name\" \r\n              class=\"title\">\r\n              <div class=\"main-title\">{{ currentRoom.name }}</div>\r\n              <div class=\"sub-title\">@{{ currentRoom.account }}</div>\r\n            </div>\r\n          </h2>\r\n          <div\r\n            class=\"private-chatroomCard\">\r\n            <PrivateChatroom \r\n              :initialCurrentRoom=\"currentRoom\"\r\n              :initialMessages=\"messages\"\r\n              :initialMessageLoadMore=\"messageLoadMore\"\r\n              @after-post-msg=\"afterPostMsg\"\r\n              @after-scroll-top=\"afterScrollTop\"\r\n              @after-show-user-list-modal=\"afterShowUserListModal\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </div>\r\n    <!-- Button trigger modal -->\r\n    <div\r\n      v-if=\"isShowModal\"\r\n      class=\"modal fade\"\r\n      id=\"newMessageModal\"\r\n      data-backdrop=\"static\" \r\n      data-keyboard=\"false\" \r\n      tabindex=\"-1\"\r\n      aria-labelledby=\"newMessageModalLabel\"\r\n      aria-hidden=\"true\"\r\n    >\r\n      <!-- Modal -->\r\n      <div class=\"modal-dialog\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <button\r\n              type=\"button\"\r\n              class=\"close\"\r\n              data-dismiss=\"modal\"\r\n              aria-label=\"Close\"\r\n              @click=\"cancelModal\"\r\n            >\r\n              <img src=\"~@/assets/img/icon_close-og.svg\" alt=\"\" />\r\n            </button>\r\n            <span>新訊息</span>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            <form class=\"create-tweet\" action=\"\">\r\n              <ul class=\"message-users\">\r\n                <li v-if=\"msgUsersFollowing.length > 0\" class=\"following\">正在跟隨的使用者</li>\r\n                <li \r\n                  v-for=\"user of msgUsersFollowing\" \r\n                  :key=\"user.id\" \r\n                  class=\"message-user\"\r\n                  @click=\"joinUserRoomAwait(user)\">\r\n                  <div class=\"avatar\">\r\n                    <img :src=\"user.avatar | emptyImage\" alt=\"\">\r\n                  </div>\r\n                  <div class=\"user-info\">\r\n                    <span ref=\"\" class=\"name\">{{ user.name }}</span>\r\n                    <span class=\"account\">@{{ user.account }}</span>\r\n                  </div>\r\n                  <button v-if=\"user.joinUserRoomAwait\" class=\"btn\" @click.prevent.stop=\"joinUserRoomConfirm(user)\">開始聊天</button>\r\n                </li>\r\n                <li v-if=\"msgUsersUnFollowing.length > 0\" class=\"un-following\">其他未跟隨的使用者</li>\r\n                <li \r\n                  v-for=\"user of msgUsersUnFollowing\" \r\n                  :key=\"user.id\" \r\n                  class=\"message-user\"\r\n                  @click=\"joinUserRoomAwait(user)\">\r\n                  <div class=\"avatar\">\r\n                    <img :src=\"user.avatar | emptyImage\" alt=\"\">\r\n                  </div>\r\n                  <div class=\"user-info\">\r\n                    <span ref=\"\" class=\"name\">{{ user.name }}</span>\r\n                    <span class=\"account\">@{{ user.account }}</span>\r\n                  </div>\r\n                  <button v-if=\"user.joinUserRoomAwait\" class=\"btn\" @click.prevent.stop=\"joinUserRoomConfirm(user)\">開始聊天</button>\r\n                </li>\r\n              </ul>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { mapState } from 'vuex'\r\nimport { emptyImageFilter } from \"../utils/mixins\"\r\nimport { Toast } from \"./../utils/helpers\"\r\nimport usersAPI from \"../apis/users\"\r\nimport Sidebar from \"./../components/Sidebar.vue\"\r\nimport UserRooms from \"./../components/UserRooms.vue\"\r\nimport PrivateChatroom from \"./../components/PrivateChatroom.vue\"\r\nimport Spinner from './../components/Spinner'\r\nimport $ from 'jquery'\r\n\r\nexport default {\r\n  name: 'PrivateMessage',\r\n  mixins: [emptyImageFilter],\r\n  components: {\r\n    Sidebar,\r\n    UserRooms,\r\n    PrivateChatroom,\r\n    Spinner\r\n  },\r\n  data() {\r\n    return {\r\n      socket: null,\r\n      userRooms: [],\r\n      userRoomsLimit: 100,\r\n      currentRoom: {},\r\n      userRoomAwait: {},\r\n      privateRoomAwait: {},\r\n      getPrivateRoomId: 0,\r\n      messages: [],\r\n      messageLoadMore: 0,\r\n      msgUnseenNum: 0,\r\n      msgUnseenRooms: [],\r\n      msgUnreadRooms: [],\r\n      msgUsersFollowing: [],\r\n      msgUsersUnFollowing: [],\r\n      isLoading: true,\r\n      isShowModal: false\r\n    }\r\n  }, \r\n  computed: {\r\n    ...mapState(['currentUser'])\r\n  },\r\n  watch: {\r\n    privateRoomAwait() {\r\n      this.currentRoom = this.privateRoomAwait\r\n      const User1Id = this.currentUser.id\r\n      const User2Id = this.currentRoom.userId\r\n      const RoomId = this.currentRoom.id\r\n\r\n      this.joinPrivateRoom({ User1Id, User2Id, RoomId })\r\n      this.getPrivateHistory(RoomId, 20)\r\n    },\r\n    msgUnreadRooms() {\r\n      for (let i = 0; i < this.msgUnreadRooms.length; i++) {\r\n        this.userRooms = this.userRooms.map( user => {\r\n          const { id, lastMsg, roomMember, isLinked } = user\r\n          const unreadNum = user.roomMember.id === this.msgUnreadRooms[i].SenderId ? this.msgUnreadRooms[i].unreadNum : user.unreadNum\r\n          return { id, lastMsg, roomMember, isLinked, unreadNum }\r\n        })\r\n      }\r\n    },\r\n    getPrivateRoomId() {\r\n      this.currentRoom.id = this.getPrivateRoomId\r\n      this.privateRoomAwait = this.currentRoom\r\n      localStorage.setItem('privateRoomAwait', JSON.stringify(this.privateRoomAwait))\r\n\r\n      this.$router.push({ name: 'message-await', params: { id: this.getPrivateRoomId } })\r\n\r\n      if (this.userRooms.length <= 0) return\r\n\r\n      const userRoomId = Number(this.$route.params.id)\r\n      const checkPastMsg = this.userRooms.every( user => {\r\n        return user.id !== userRoomId\r\n      })\r\n      if (checkPastMsg && userRoomId) {\r\n        this.handleUserRoomAwait('立即開啟對話吧 ▸')\r\n        this.userRooms.unshift(this.userRoomAwait)\r\n      }\r\n\r\n      this.userRooms = this.userRooms.map((user) => {\r\n        if(user.id === this.currentRoom.id) {\r\n          user.isLinked = true\r\n        } else {\r\n          user.isLinked = false\r\n        }\r\n        return user\r\n      })\r\n    }\r\n  },\r\n  created() {\r\n    this.joinPrivatePage(this.currentUser.id)\r\n    this.catchUserRoomId()\r\n    this.msgUnseenNum = localStorage.getItem('msgUnseenNum')\r\n    this.fetchMsgUsers(this.currentUser.id) \r\n  },\r\n  sockets: {\r\n    join_private_room(RoomId) {\r\n      this.getPrivateRoomId = RoomId\r\n    },\r\n    get_msg_notice_details({ unseenRooms, unreadRooms }) {\r\n      this.msgUnseenRooms = unseenRooms\r\n      this.msgUnreadRooms = unreadRooms\r\n    },\r\n    update_msg_notice_details(data) {\r\n      this.messageNotice = data\r\n      this.userRooms = this.userRooms.map( user => {\r\n        if (user.id === this.messageNotice.id) {\r\n          user.lastMsg.fromRoomMember = true\r\n          user.lastMsg.content = this.messageNotice.lastMsg.content\r\n          user.lastMsg.createdAt = this.messageNotice.lastMsg.createdAt\r\n          user.unreadNum = this.messageNotice.unreadNum\r\n        }\r\n        return user\r\n      })\r\n    },\r\n    get_private_msg(data) {\r\n      this.userRooms = this.userRooms.map((user) => {\r\n        if(user.id === this.currentRoom.id) {\r\n          user.lastMsg.fromRoomMember = true\r\n          user.lastMsg.content = data.content\r\n          user.lastMsg.createdAt = data.createdAt\r\n        }\r\n        return user\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    joinPrivatePage(userId) { \r\n      this.$socket.emit('join_private_page', { userId })\r\n      localStorage.removeItem('msgUnseenNum')\r\n      this.getPrivateRooms(0, this.userRoomsLimit)\r\n    },\r\n    getPrivateRooms(offset, limit) {\r\n      this.$socket.emit('get_private_rooms', {\r\n        offset,\r\n        limit\r\n        }, data => {\r\n          this.userRooms = data.map( user => {\r\n            const { id, lastMsg, roomMember } = user\r\n            const isLinked = id === this.currentRoom.id ? true : false\r\n            return { id, lastMsg, roomMember, isLinked }\r\n          })\r\n          \r\n          const userRoomId = Number(this.$route.params.id)\r\n          const checkPastMsg = this.userRooms.every( user => {\r\n            return user.id !== userRoomId\r\n          })\r\n          if (checkPastMsg && userRoomId) {\r\n            this.handleUserRoomAwait('立即開啟對話吧 ▸')\r\n            this.userRooms.unshift(this.userRoomAwait)\r\n          }\r\n\r\n          if (this.msgUnreadRooms.length > 0) {\r\n            for (let i = 0; i < this.msgUnreadRooms.length; i++) {\r\n              this.userRooms = this.userRooms.map( user => {\r\n                const { id, lastMsg, roomMember, isLinked } = user\r\n                const unreadNum = user.roomMember.id === this.msgUnreadRooms[i].SenderId ? this.msgUnreadRooms[i].unreadNum : user.unreadNum\r\n                return { id, lastMsg, roomMember, isLinked, unreadNum }\r\n              })\r\n            }\r\n          }\r\n          this.isLoading = false\r\n        }\r\n      )\r\n    },\r\n    joinPrivateRoom({ User1Id, User2Id, RoomId }) { \r\n      this.$socket.emit('join_private_room', { User1Id, User2Id, RoomId })\r\n    },\r\n    afterClickUserRoom(user) {\r\n      this.userRoomAwait = {}\r\n\r\n      this.currentRoom = {\r\n        id: user.id,\r\n        userId: user.roomMember.id,\r\n        name: user.roomMember.name,\r\n        account: user.roomMember.account,\r\n        avatar: user.roomMember.avatar\r\n      }\r\n      this.userRooms = this.userRooms.map((user) => {\r\n        if(user.id === this.currentRoom.id) {\r\n          user.isLinked = true\r\n        } else {\r\n          user.isLinked = false\r\n        }\r\n        return user\r\n      })\r\n      this.messageLoadMore = 20\r\n\r\n      this.privateRoomAwait = this.currentRoom\r\n      localStorage.setItem('privateRoomAwait', JSON.stringify(this.privateRoomAwait))\r\n      this.$router.push({ name: 'message-await', params: { id: this.currentRoom.id } })\r\n    },\r\n    getPrivateHistory(roomId, limit) { \r\n      this.$socket.emit('get_private_history', {\r\n        offset: 0,\r\n        limit: limit,\r\n        RoomId: roomId,\r\n      }, data => {\r\n        this.messages = [\r\n          ...data.reverse()\r\n        ]\r\n        this.messages = this.messages.map( msg => {\r\n          const { UserId, avatar, content, createdAt } = msg\r\n          const isSelf = UserId === this.currentUser.id ? true : false\r\n          return { UserId, avatar, content, createdAt, isSelf }\r\n        })\r\n        this.isLoading = false\r\n      })\r\n    },\r\n    catchUserRoomId() {\r\n      const userRoomId = this.$route.params.id\r\n      if (!userRoomId) return\r\n      this.privateRoomAwait = JSON.parse(localStorage.getItem('privateRoomAwait'))\r\n    },\r\n    afterPostMsg(content) {\r\n      this.userRooms = this.userRooms.map((user) => {\r\n        if(user.id === this.currentRoom.id) {\r\n          user.lastMsg.fromRoomMember = false\r\n          user.lastMsg.content = content\r\n          user.lastMsg.createdAt = new Date()\r\n        } \r\n        return user\r\n      })\r\n    },\r\n    handleUserRoomAwait(data) {\r\n      this.userRoomAwait = {\r\n        awaitMsg: true,\r\n        id: this.currentRoom.id,\r\n        isLinked: true,\r\n        lastMsg: {\r\n          content: data,\r\n          createdAt: '',\r\n          fromRoomMember: true\r\n        },\r\n        roomMember: {\r\n          account: this.currentRoom.account,\r\n          avatar: this.currentRoom.avatar,\r\n          id: this.currentRoom.userId,\r\n          name: this.currentRoom.name\r\n        }\r\n      }\r\n    },\r\n    userRoomsHandleScroll(e) {\r\n      if (e.srcElement.scrollTop + e.srcElement.offsetHeight >= e.srcElement.scrollHeight ) {\r\n        this.loadMore()\r\n      }\r\n    },\r\n    loadMore() {\r\n      if (this.userRooms.length >= this.userRoomsLimit) {\r\n        const offset = 0\r\n        const limit = this.userRooms.length + 5\r\n        this.getPrivateRooms(offset, limit)\r\n        this.userRoomsLimit = limit\r\n      } else {\r\n        this.userRoomsLimit = 'limited'\r\n      }\r\n    },\r\n    afterScrollTop(limit) {\r\n      this.getPrivateHistory(this.currentRoom.id, limit)\r\n      this.messageLoadMore = limit\r\n    },\r\n    async fetchMsgUsers(userId) {\r\n      try {\r\n        const responseGetFollowingUsers = await usersAPI.getFollowings({ \r\n          userId,\r\n          offset: 0,\r\n          limit: 50\r\n        })\r\n        this.msgUsersFollowing = [ ...responseGetFollowingUsers.data ].map( user => {\r\n          const { following } = user\r\n          const msgUser = {\r\n            id: following.id,\r\n            account: following.account,\r\n            name: following.name,\r\n            avatar: following.avatar,\r\n            joinUserRoomAwait: false\r\n          }\r\n          return msgUser\r\n        })\r\n\r\n        const responseGetOtherUsers = await usersAPI.getTopUsers({\r\n          offset: 0,\r\n          limit: 50\r\n        })\r\n        this.msgUsersUnFollowing = [...responseGetOtherUsers.data]\r\n\r\n      } catch (error) {\r\n        Toast.fire({\r\n          icon: \"warning\",\r\n          title: \"無法取得使用者清單，請稍後再試\",\r\n        })\r\n      }\r\n    },\r\n    joinUserRoomAwait(msgUser) {\r\n      this.msgUsersFollowing = this.msgUsersFollowing.map( user => {\r\n        if(user.id === msgUser.id) {\r\n          user.joinUserRoomAwait = true\r\n        } else {\r\n          user.joinUserRoomAwait = false\r\n        }\r\n        return user\r\n      })\r\n      this.msgUsersUnFollowing = this.msgUsersUnFollowing.map( user => {\r\n        if(user.id === msgUser.id) {\r\n          user.joinUserRoomAwait = true\r\n        } else {\r\n          user.joinUserRoomAwait = false\r\n        }\r\n        return user\r\n      })\r\n    },\r\n    joinUserRoomConfirm(user) {\r\n      this.userRoomAwait = {}\r\n      this.currentRoom = {\r\n        id: null,\r\n        userId: user.id,\r\n        name: user.name,\r\n        account: user.account,\r\n        avatar: user.avatar\r\n      }\r\n      \r\n      const User1Id = this.currentUser.id\r\n      const User2Id = user.id\r\n      const RoomId = null\r\n\r\n      this.$socket.emit('join_private_room', { User1Id, User2Id, RoomId })\r\n\r\n      this.joinUserRoomAwaitToFalse()\r\n      $(`#newMessageModal`).modal(\"hide\")\r\n    },\r\n    joinUserRoomAwaitToFalse() {\r\n      this.msgUsersFollowing = this.msgUsersFollowing.map( user => {\r\n        const { id, account, name, avatar } = user\r\n        const joinUserRoomAwait = false\r\n        return { id, account, name, avatar, joinUserRoomAwait }\r\n      })\r\n      this.msgUsersUnFollowing = this.msgUsersUnFollowing.map( user => {\r\n        const { id, account, name, avatar } = user\r\n        const joinUserRoomAwait = false\r\n        return { id, account, name, avatar, joinUserRoomAwait }\r\n      })\r\n    },\r\n    afterShowUserListModal() {\r\n      this.showModal()\r\n    },\r\n    showModal() {\r\n      this.isShowModal = true\r\n    },\r\n    cancelModal() {\r\n      this.joinUserRoomAwaitToFalse()\r\n      this.isShowModal = false\r\n    },\r\n    leavePrivatePage() {\r\n      this.$socket.emit('leave_private_page')\r\n    },\r\n  },\r\n  beforeDestroy () {\r\n    this.leavePrivatePage()\r\n  }\r\n}\r\n</script>\r\n<style scoped>\r\n.container {\r\n  display: grid;\r\n  grid-template-columns: 20% auto;\r\n  max-width: 1500px;\r\n  margin: 0 auto;\r\n  padding: 0 20px;\r\n}\r\n.private-message-wrap {\r\n  display: flex;\r\n}\r\n.private-users {\r\n  width: 45%;\r\n}\r\n.private-chatroom {\r\n  width: 55%;\r\n}\r\n.private-chatroom,\r\n.private-users {\r\n  position: relative;\r\n  margin-top: 50px;\r\n  border-left: 1px solid #e6ecf0;\r\n}\r\n.private-chatroom,\r\n.private-chatroom .headbar {\r\n  border-right: 1px solid #e6ecf0;\r\n}\r\n.private-users-wrap {\r\n  max-height: calc(100vh - 50px);\r\n  /* max-height: 300px; */\r\n}\r\n.private-chatroom-wrap {\r\n  /* overflow-y: auto; */\r\n  max-height: calc(100vh - 50px);\r\n}\r\n.private-users-wrap {\r\n  overflow-y: scroll;\r\n}\r\n.headbar {\r\n  position: absolute;\r\n  top: -50px;\r\n  left: 0;\r\n  z-index: 10;\r\n  display: flex;  \r\n  align-items: center;\r\n  width: 100%;\r\n  height: 50px;\r\n  margin: 0;\r\n  padding: 5px 20px;\r\n  font-size: 18px;\r\n  text-align: left;\r\n  border-width: 0 0 1px 1px;\r\n  border-style: solid;\r\n  border-color: #e6ecf0;\r\n  background: #fff;\r\n  transform: translateX(-1px);\r\n}\r\n.private-chatroom .headbar {\r\n  transform: scale(1, 1.004);\r\n}\r\n.private-users .title {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  width: 100%;\r\n}\r\n.main-title {\r\n  font-weight: 900;\r\n}\r\n.sub-title {\r\n  font-size: 13px;\r\n  color: #657786;\r\n}\r\n.avatar {\r\n  display: inline-block;\r\n}\r\n.add-msg-user {\r\n  cursor: pointer;\r\n}\r\n.add-msg-user:hover img {\r\n  filter: invert(73%) sepia(100%) saturate(48) hue-rotate(364deg);\r\n  /* transition: .2s ease; */\r\n}\r\n.private-users-list li.limited {\r\n  margin: 20px;\r\n  color: #ccc;\r\n}\r\n.modal-content {\r\n  overflow: hidden;\r\n}\r\n.modal-header {\r\n  justify-content: flex-start;\r\n  font-size: 18px;\r\n  font-weight: bold;\r\n}\r\n.modal-header span {\r\n  margin-left: 20px;\r\n}\r\n.close {\r\n  margin: 0;\r\n  padding: 0;\r\n  opacity: 1;\r\n}\r\n.modal-body {\r\n  padding: 0;\r\n}\r\n.message-users {\r\n  overflow-y: scroll;\r\n  height: 80vh;\r\n  max-height: 800px;\r\n  margin-bottom: 0;\r\n}\r\n.message-users li {\r\n  position: relative;\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 10px 15px;\r\n  width: 100%;\r\n  border-bottom: 1px solid #e6ecf0;\r\n}\r\n.message-users li:last-child {\r\n  border-bottom: none;\r\n}\r\n.message-user:hover {\r\n  background-color: #f5f8fa;\r\n  cursor: pointer;\r\n}\r\n.message-users li .user-info * {\r\n  display: block;\r\n  text-align: left;\r\n}\r\n.message-users .btn {\r\n  position: absolute;\r\n  right: 15px;\r\n  color: #fff;\r\n  background-color: #ff6600;\r\n}\r\n.message-users .following,\r\n.message-users .un-following {\r\n  font-weight: bold;\r\n}\r\n.message-users .un-following  {\r\n  border-top: 9px solid #dce2e6;\r\n}\r\n@media (max-width: 992px) {\r\n  .container {\r\n    padding-right: 0;\r\n  }\r\n  .private-message-wrap {\r\n    flex-direction: column;\r\n  }\r\n  .private-message-wrap section {\r\n    width: 100%;\r\n  }\r\n  .private-users-wrap {\r\n    height: 20vh;\r\n  }\r\n  .chat-wrap {\r\n    height: calc( 100vh - 20vh - 99px );\r\n  }\r\n  .private-chatroom .headbar{\r\n    border-top: 1px solid #e6ecf0;\r\n    transform: translateX(-1px);\r\n  }\r\n  .new-tweet {\r\n    display: none;\r\n  }\r\n}\r\n@media (max-width: 576px) {\r\n  .container {\r\n    grid-template-columns: 13% auto;\r\n  }\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrivateMessage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PrivateMessage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PrivateMessage.vue?vue&type=template&id=291bcd40&scoped=true&\"\nimport script from \"./PrivateMessage.vue?vue&type=script&lang=js&\"\nexport * from \"./PrivateMessage.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PrivateMessage.vue?vue&type=style&index=0&id=291bcd40&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"291bcd40\",\n  null\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/icon_mail-add.86903ff0.svg\";"],"sourceRoot":""}